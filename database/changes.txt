*** 04-02-2005 ****
- "turq_banks_transaction_bills" --> "banks_cards_id" column 
- "turq_banks_transactions"      --> "banks_cards_id" (integer) added 
-  Foreign key "banks_cards_id" from to "turq_banks_transactions" to "turq_banks_card"
- "turq_inventory_transactions" ---> "transaction_type" (integer) added 

*** 06-02-2005 *** 
-  "turq_inventory_transactions" ---> "transactions_amount_in" (int8) column changed to 
												"transactions_amount_in" numeric
-  "turq_inventory_transactions" ---> "transactions_total_amount_out" (int8) column changed to 

-  "turq_inventory_card_units" ---> "card_units_factor" changed column prop. int4 to numeric
												"transactions_total_amount_out" numeric
												
---Process---
!!!! Before drop, do not forget to backup the data inside tha tables!!!!!!!!!!!!!!!!!

DROP VIEW turq_view_inventory_totals;
DROP VIEW turq_view_inventory_amount_total;
DROP TABLE turq_inventory_transactions;

CREATE TABLE turq_inventory_transactions
(
  inventory_transactions_id int4 NOT NULL,
  inventory_cards_id int4 NOT NULL,
  inventory_warehouses_id int4 NOT NULL,
  engine_sequences_id int4 NOT NULL,
  transactions_amount_in numeric NOT NULL,
  inventory_units_id int4 NOT NULL,
  transactions_unit_price numeric NOT NULL,
  transactions_total_price numeric NOT NULL,
  transactions_discount numeric NOT NULL,
  transactions_discount_amount numeric NOT NULL,
  transactions_vat int4 NOT NULL,
  transactions_vat_amount numeric NOT NULL,
  transactions_vat_special_each numeric NOT NULL,
  transactions_vat_special numeric NOT NULL,
  transactions_vat_special_amount numeric NOT NULL,
  transactions_cumilative_price numeric NOT NULL,
  transactions_total_amount_out numeric NOT NULL,
  created_by varchar(50) NOT NULL,
  creation_date date NOT NULL,
  updated_by varchar(50) NOT NULL,
  last_modified date NOT NULL,
  transactions_date date NOT NULL,
  transaction_type int4 NOT NULL,
  CONSTRAINT turq_inventory_transactions_pkey PRIMARY KEY (inventory_transactions_id),
  CONSTRAINT "$100" FOREIGN KEY (engine_sequences_id) REFERENCES turq_engine_sequences (engine_sequences_id) ON UPDATE RESTRICT ON DELETE RESTRICT,
  CONSTRAINT "$15" FOREIGN KEY (inventory_warehouses_id) REFERENCES turq_inventory_warehouses (inventory_warehouses_id) ON UPDATE RESTRICT ON DELETE RESTRICT,
  CONSTRAINT "$16" FOREIGN KEY (inventory_cards_id) REFERENCES turq_inventory_cards (inventory_cards_id) ON UPDATE RESTRICT ON DELETE RESTRICT,
  CONSTRAINT "$17" FOREIGN KEY (inventory_units_id) REFERENCES turq_inventory_units (inventory_units_id) ON UPDATE RESTRICT ON DELETE RESTRICT
) 
WITHOUT OIDS;


CREATE OR REPLACE VIEW turq_view_inventory_totals AS 
 SELECT trans.inventory_cards_id, transin.totalamountin AS total_amount_in, transin.totalpricein AS total_price_in, transout.totalamountout AS total_amount_out, transout.totalpriceout AS total_price_out
   FROM turq_inventory_cards trans
   LEFT JOIN ( SELECT turq_inventory_transactions.inventory_cards_id, sum(turq_inventory_transactions.transactions_total_price) AS totalpricein, sum(turq_inventory_transactions.transactions_amount_in) AS totalamountin
                FROM turq_inventory_transactions
               WHERE turq_inventory_transactions.transactions_amount_in <> 0
               GROUP BY turq_inventory_transactions.inventory_cards_id) transin ON trans.inventory_cards_id = transin.inventory_cards_id
   LEFT JOIN ( SELECT turq_inventory_transactions.inventory_cards_id, sum(turq_inventory_transactions.transactions_total_price) AS totalpriceout, sum(turq_inventory_transactions.transactions_total_amount_out) AS totalamountout
                FROM turq_inventory_transactions
               WHERE turq_inventory_transactions.transactions_total_amount_out <> 0
               GROUP BY turq_inventory_transactions.inventory_cards_id) transout ON trans.inventory_cards_id = transout.inventory_cards_id;




CREATE OR REPLACE VIEW turq_view_inventory_amount_total AS 
 SELECT cards.inventory_cards_id, tabletrans.transactions_amount_in, tabletrans.transactions_total_amount_out, tabletrans.transactions_total_amount_now
   FROM turq_inventory_cards cards
   LEFT JOIN ( SELECT trans.inventory_cards_id, sum(trans.transactions_amount_in) AS transactions_amount_in, sum(trans.transactions_total_amount_out) AS transactions_total_amount_out, sum(trans.transactions_amount_in - trans.transactions_total_amount_out) AS transactions_total_amount_now
                FROM turq_inventory_transactions trans
               GROUP BY trans.inventory_cards_id) tabletrans ON tabletrans.inventory_cards_id = cards.inventory_cards_id;



*** 06-02-2005 **** 

-- "turq_inventory_groups" ---> "parent_group" (integer) column added
-- Foreign key from "parent_group" to "inventory_groups_id" in "turq_inventory_groups"

----Process---

ALTER TABLE turq_inventory_groups ADD COLUMN parent_group int4;

INSERT INTO turq_inventory_groups VALUES (-1, 'Varsayilan', 'Varsayilan', 'admin', '2005-01-14', 'admin', '2005-01-14', -1);

update turq_inventory_groups set parent_group =-1

ALTER TABLE turq_inventory_groups
   ALTER COLUMN parent_group SET NOT NULL;
   
ALTER TABLE turq_inventory_groups ADD CONSTRAINT ig1 FOREIGN KEY (parent_group) REFERENCES turq_inventory_groups (inventory_groups_id)    ON UPDATE RESTRICT ON DELETE RESTRICT;
   
INSERT INTO turq_inventory_groups VALUES (-1, 'Varsayilan', 'Varsayilan', 'admin', '2005-01-14', 'admin', '2005-01-14', -1);



**** 09-02-2005 *****
--- "turq_banks_transactions"  ----> "accounting_accounts_id" removed... 

ALTER TABLE turq_banks_transactions DROP COLUMN accounting_accounts_id;

**** 14-02-2005 *****
--- "turq_cheque_cheques" -----> "bank_account_no" column added...

ALTER TABLE turq_cheque_cheques ADD COLUMN bank_account_no varchar(100);
update turq_cheque_cheques set bank_account_no='';
ALTER TABLE turq_cheque_cheques
   ALTER COLUMN bank_account_no SET NOT NULL;


**** 15-02-2005 ****
--- "turq_bank_transactions_type" ---> "Bankaya Gelen Cek" --> Tahsil Edilen Cek...


**** 16-02-2005 **** 
---- "turq_cheque_rolls" --> sum totals column added...

ALTER TABLE turq_cheque_rolls
   ADD COLUMN sum_cheque_amounts bool;
   
update turq_cheque_rolls set sum_cheque_amounts = false;
   
ALTER TABLE turq_cheque_rolls
   ALTER COLUMN sum_cheque_amounts SET NOT NULL;



************* 17 FEBRUARY 0.6 ALPHA5 NEW VERSION RELEASED **********



INSERT INTO turq_cheque_transaction_types VALUES (2, 'Bankaya Cikis', 2, 3, 'admin', '2005-01-01', 'admin', '2005-01-01');
INSERT INTO turq_cheque_transaction_types VALUES (3, 'Bankadan Tahsil', 3, 3, 'admin', '2005-01-01', 'admin', '2005-01-01');


******CHANGES ON ACCOUNTING TABLES********

CREATE TABLE turq_accounting_account_classes (
    accounting_classes_id integer NOT NULL,
    accounting_classes_name character varying(50) NOT NULL,
    accounting_classes_definition character varying(50) NOT NULL,
    created_by character varying(25) NOT NULL,
    creation_date date NOT NULL,
    updated_by character varying(25) NOT NULL,
    last_modified date NOT NULL
);

ALTER TABLE turq_accounting_account_classes ADD PRIMARY KEY (accounting_classes_id);


CREATE TABLE turq_accounting_account_types (
    accounting_types_id integer NOT NULL,
    accounting_types_name character varying(50) NOT NULL,
    accounting_types_definition character varying(250) NOT NULL,
    created_by character varying(25) NOT NULL,
    creation_date date NOT NULL,
    updated_by character varying(25) NOT NULL,
    last_modified date NOT NULL
);

ALTER TABLE turq_accounting_account_types ADD PRIMARY KEY (accounting_types_id);




insert into turq_accounting_account_classes values (1,'DONEN VARLIKLAR','','admin','02-17-2005','admin','02-17-2005');
insert into turq_accounting_account_classes values (2,'DURAN VARLIKLAR','','admin','02-17-2005','admin','02-17-2005');
insert into turq_accounting_account_classes values (3,'KISA VADELI YABANCI KAYNAKLAR','','admin','02-17-2005','admin','02-17-2005');
insert into turq_accounting_account_classes values (4,'UZUN VADELI YABANCI KAYNAKLAR','','admin','02-17-2005','admin','02-17-2005');
insert into turq_accounting_account_classes values (5,'OZKAYNAKLAR','','admin','02-17-2005','admin','02-17-2005');
insert into turq_accounting_account_classes values (6,'GELIR TABLOSU HESAPLARI','','admin','02-17-2005','admin','02-17-2005');
insert into turq_accounting_account_classes values (7,'MALIYET HESAPLARI','','admin','02-17-2005','admin','02-17-2005');
insert into turq_accounting_account_classes values (8,'YONETIM MUHASEBESI HESAPLARI','','admin','02-17-2005','admin','02-17-2005');
insert into turq_accounting_account_classes values (9,'NAZIM HESAPLAR','','admin','02-17-2005','admin','02-17-2005');






insert into turq_accounting_account_types values (1,'HAZIR DEGERLER','','admin','02-17-2005','admin','02-17-2005');
insert into turq_accounting_account_types values (2,'MENKUL KIYMETLER','','admin','02-17-2005','admin','02-17-2005');
insert into turq_accounting_account_types values (3,'TICARI ALACAKLAR','','admin','02-17-2005','admin','02-17-2005');
insert into turq_accounting_account_types values (4,'DIGER ALACAKLAR','','admin','02-17-2005','admin','02-17-2005');
insert into turq_accounting_account_types values (5,'STOKLAR','','admin','02-17-2005','admin','02-17-2005');
insert into turq_accounting_account_types values (6,'YILLARA YAYGIN INSAAT VE ONARIM MALIYETLERI','','admin','02-17-2005','admin','02-17-2005');
insert into turq_accounting_account_types values (7,'GELECEK AYLARA AIT GIDERLER VE GELIR TAAHHUKLARI','','admin','02-17-2005','admin','02-17-2005');
insert into turq_accounting_account_types values (8,'DIGER DONEN VARLIKLAR','','admin','02-17-2005','admin','02-17-2005');
insert into turq_accounting_account_types values (9,'MALI DURAN VARLIKLAR','','admin','02-17-2005','admin','02-17-2005');
insert into turq_accounting_account_types values (10,'MADDI DURAN VARLIKLAR','','admin','02-17-2005','admin','02-17-2005');
insert into turq_accounting_account_types values (11,'MADDI OLMAYAN DURAN VARLIKLAR','','admin','02-17-2005','admin','02-17-2005');
insert into turq_accounting_account_types values (12,'OZEL TUKENMEYE TABI VARLIKLAR','','admin','02-17-2005','admin','02-17-2005');
insert into turq_accounting_account_types values (13,'GELECEK YILLARA AIT GIDERLER VE GELIR TAAHHUKLARI','','admin','02-17-2005','admin','02-17-2005');
insert into turq_accounting_account_types values (14,'DIGER DURAN VARLIKLAR','','admin','02-17-2005','admin','02-17-2005');
insert into turq_accounting_account_types values (15,'MALI BORCLAR','','admin','02-17-2005','admin','02-17-2005');
insert into turq_accounting_account_types values (16,'TICARI BORCLAR','','admin','02-17-2005','admin','02-17-2005');
insert into turq_accounting_account_types values (17,'DIGER BORCLAR','','admin','02-17-2005','admin','02-17-2005');
insert into turq_accounting_account_types values (18,'ALINAN AVANSLAR','','admin','02-17-2005','admin','02-17-2005');
insert into turq_accounting_account_types values (19,'BORC VE DIGER KARSILIKLARI','','admin','02-17-2005','admin','02-17-2005');
insert into turq_accounting_account_types values (20,'GELECEK YILLARA AIT GELIRLER VE GIDER TAAHHUKLARI','','admin','02-17-2005','admin','02-17-2005');
insert into turq_accounting_account_types values (21,'DIGER UZUN VADELI YABANCI KAYNAKLAR','','admin','02-17-2005','admin','02-17-2005');
insert into turq_accounting_account_types values (22,'GELECEK AYLARA AIT GELIR VE GIDER TAAHHUKLARI','','admin','02-17-2005','admin','02-17-2005');
insert into turq_accounting_account_types values (23,'ODENMIS SERMAYE','','admin','02-17-2005','admin','02-17-2005');
insert into turq_accounting_account_types values (24,'SERMAYE YEDEKLERI','','admin','02-17-2005','admin','02-17-2005');
insert into turq_accounting_account_types values (25,'KAR YEDEKLERI','','admin','02-17-2005','admin','02-17-2005');
insert into turq_accounting_account_types values (26,'GECMIS YILLAR KARLARI','','admin','02-17-2005','admin','02-17-2005');
insert into turq_accounting_account_types values (27,'GECMIS YILLAR ZARARLARI','','admin','02-17-2005','admin','02-17-2005');
insert into turq_accounting_account_types values (28,'DONEM NET KARI(ZARARI)','','admin','02-17-2005','admin','02-17-2005');
insert into turq_accounting_account_types values (29,'BRUT SATISLAR','','admin','02-17-2005','admin','02-17-2005');
insert into turq_accounting_account_types values (30,'SATIS INDIRIMLERI (-)','','admin','02-17-2005','admin','02-17-2005');
insert into turq_accounting_account_types values (31,'SATISLARIN MALIYETLERI (-)','','admin','02-17-2005','admin','02-17-2005');
insert into turq_accounting_account_types values (32,'FAALIYET GIDERLERI (-)','','admin','02-17-2005','admin','02-17-2005');
insert into turq_accounting_account_types values (33,'DIGER FAALIYETLERDEN OLAGAN GELIR VE KARLAR','','admin','02-17-2005','admin','02-17-2005');
insert into turq_accounting_account_types values (34,'DIGER FAALIYETLERDEN OLAGAN GIDER VE ZARARLAR (-)','','admin','02-17-2005','admin','02-17-2005');
insert into turq_accounting_account_types values (35,'FINANSMAN GIDERLERI(-)','','admin','02-17-2005','admin','02-17-2005');
insert into turq_accounting_account_types values (36,'OLAGANDISI GELIR VE KARLAR','','admin','02-17-2005','admin','02-17-2005');
insert into turq_accounting_account_types values (37,'OLAGANDISI GIDER VE ZARARLAR(-)','','admin','02-17-2005','admin','02-17-2005');
insert into turq_accounting_account_types values (38,'MALIYET MUHASEBES BAGLANTI HESAPLARI','','admin','02-17-2005','admin','02-17-2005');
insert into turq_accounting_account_types values (39,'DIREKT ILKMADDE VE MALZEME GIDERLERI','','admin','02-17-2005','admin','02-17-2005');
insert into turq_accounting_account_types values (40,'DIREKT ISCILIK GIDERLERI','','admin','02-17-2005','admin','02-17-2005');
insert into turq_accounting_account_types values (41,'GENEL URETIM GIDERLERI','','admin','02-17-2005','admin','02-17-2005');
insert into turq_accounting_account_types values (42,'HIZMET URETIM MALIYETLERI','','admin','02-17-2005','admin','02-17-2005');
insert into turq_accounting_account_types values (43,'ARASTIRMA VE GELISTIRME GIDERLERI','','admin','02-17-2005','admin','02-17-2005');
insert into turq_accounting_account_types values (44,'PAZARLAMA SATIS VE DAGITIM GIDERLERI','','admin','02-17-2005','admin','02-17-2005');
insert into turq_accounting_account_types values (45,'GENEL YONETIM GIDERLERI','','admin','02-17-2005','admin','02-17-2005');
insert into turq_accounting_account_types values (46,'FINANSMAN GIDERLERI (-)','','admin','02-17-2005','admin','02-17-2005');
insert into turq_accounting_account_types values (47,'FINANSMAN GIDERLERI ','','admin','02-17-2005','admin','02-17-2005');

ALTER TABLE turq_accounting_transaction_columns ADD COLUMN rows_currency_type int4;

update turq_accounting_transaction_columns set rows_currency_type = 1;

ALTER TABLE turq_accounting_transaction_columns ALTER COLUMN rows_currency_type SET NOT NULL;




ALTER TABLE turq_accounting_transaction_columns ADD COLUMN rows_dept_in_base_currency numeric;
update turq_accounting_transaction_columns set rows_dept_in_base_currency = dept_amount;
ALTER TABLE turq_accounting_transaction_columns ALTER COLUMN rows_dept_in_base_currency SET NOT NULL;



ALTER TABLE turq_accounting_transaction_columns ADD COLUMN rows_credit_in_base_currency numeric;
update turq_accounting_transaction_columns set rows_credit_in_base_currency = credit_amount;
ALTER TABLE turq_accounting_transaction_columns ALTER COLUMN rows_credit_in_base_currency SET NOT NULL;



ALTER TABLE turq_accounting_accounts
   ADD COLUMN accounting_types_id int4;

ALTER TABLE turq_accounting_accounts
   ADD COLUMN accounting_class_id int4;


update turq_accounting_accounts set accounting_types_id = 1;
update turq_accounting_accounts set accounting_class_id = 1;





ALTER TABLE turq_accounting_transaction_columns ADD CONSTRAINT ac1 FOREIGN KEY (rows_currency_type) REFERENCES turq_currencies (currencies_id)    ON UPDATE RESTRICT ON DELETE RESTRICT;


ALTER TABLE turq_currencies
   ADD COLUMN default_currency bool;

update turq_currencies set default_currency = false;

ALTER TABLE turq_currencies
   ALTER COLUMN default_currency SET NOT NULL;

ALTER TABLE turq_accounting_accounts ADD CONSTRAINT at1 FOREIGN KEY (accounting_types_id) REFERENCES turq_accounting_account_types (accounting_types_id)    ON UPDATE RESTRICT ON DELETE RESTRICT;

ALTER TABLE turq_accounting_accounts ADD CONSTRAINT ac1 FOREIGN KEY (accounting_class_id) REFERENCES turq_accounting_account_classes (accounting_classes_id)    ON UPDATE RESTRICT ON DELETE RESTRICT;




*********currency_exhange_rate_added (18-02-2005)*********************
CREATE TABLE public.turq_currency_exchange_rates
(
   exchange_rates_id int4 NOT NULL, 
   exhange_rates_date date NOT NULL, 
   base_currency_id int4 NOT NULL, 
   exchange_currency_id int4 NOT NULL, 
   exchange_ratio numeric NOT NULL, 
    PRIMARY KEY (exchange_rates_id), 
   CONSTRAINT fc1 FOREIGN KEY (base_currency_id) REFERENCES turq_currencies (currencies_id)    ON UPDATE RESTRICT ON DELETE RESTRICT, 
   CONSTRAINT fc2 FOREIGN KEY (exchange_currency_id) REFERENCES turq_currencies (currencies_id)    ON UPDATE RESTRICT ON DELETE RESTRICT, 
   CONSTRAINT uniq_value UNIQUE (exhange_rates_date, base_currency_id, exchange_currency_id)
) WITHOUT OIDS;

*******************************************************


******* (18-02-2005)*************
----turq_accounting_transactions ---> "currencies_id" added..

ALTER TABLE turq_accounting_transactions ADD COLUMN currencies_id int4;
ALTER TABLE turq_accounting_transactions ADD CONSTRAINT "accTransCurrencies" FOREIGN KEY (currencies_id) REFERENCES turq_currencies (currencies_id)    ON UPDATE RESTRICT ON DELETE RESTRICT;

update turq_accounting_transactions set currencies_id =1;
ALTER TABLE turq_accounting_transactions
   ALTER COLUMN currencies_id SET NOT NULL;
*******************************************************   
   
   
************ (19-02-2005) *****************   
---turq_view_cheque_status_changed---- 


DROP VIEW turq_view_cheque_status;

CREATE VIEW turq_view_cheque_status AS 
 SELECT cheq.cheque_cheques_id, cheq.cheques_portfolio_no, cheq.cheques_no, cheq.banks_id, cheq.cheques_due_date, cheq.cheques_debtor, cheq.cheques_payment_place, cheq.cheques_value_date, cheq.cheques_amount, cheq.currencies_id, transtype.cheque_transaction_types_id, transtype.transaction_typs_name, transtype.accounting_accounts_id, rolls.cheque_rolls_id, rolls.cheque_rolls_date, rolls.engine_sequences_id, rolls.cheque_roll_no, rolls.current_cards_id, rolls.banks_cards_id
FROM turq_cheque_cheques cheq, turq_cheque_rolls rolls, turq_cheque_cheque_in_rolls cheqrolls, turq_cheque_transaction_types transtype

WHERE cheq.cheque_cheques_id = cheqrolls.cheque_cheques_id AND rolls.cheque_rolls_id = cheqrolls.cheque_rolls_id AND transtype.cheque_transaction_types_id = rolls.cheque_transaction_types_id 
AND rolls.cheque_rolls_id = (( SELECT max(roll_inner.cheque_rolls_id)
FROM turq_cheque_rolls roll_inner, turq_cheque_cheque_in_rolls cheqroll_inner, turq_cheque_cheques cheq_inner
WHERE cheqroll_inner.cheque_rolls_id = roll_inner.cheque_rolls_id AND cheqroll_inner.cheque_cheques_id = cheq_inner.cheque_cheques_id AND cheqroll_inner.cheque_cheques_id = cheq.cheque_cheques_id));

******************** ***************************************
  
********************* New Table Added *****************************   
--turq_cheuqe_roll_accounting_accounts-----

  CREATE TABLE turq_cheque_roll_accounting_accounts
(
  cheque_rolls_id integer NOT NULL,
  accounting_accounts_id integer NOT NULL,
  CONSTRAINT turq_cheque_roll_accounting_accounts_pkey PRIMARY KEY (cheque_rolls_id),
  CONSTRAINT crac1 FOREIGN KEY (accounting_accounts_id) REFERENCES turq_accounting_accounts (accounting_accounts_id) ON UPDATE RESTRICT ON DELETE RESTRICT,
  CONSTRAINT crac2 FOREIGN KEY (cheque_rolls_id) REFERENCES turq_cheque_rolls (cheque_rolls_id) ON UPDATE RESTRICT ON DELETE RESTRICT
) 

**********************************************************************


*******************New Default Values ***********************************
INSERT INTO turq_module_components VALUES (77, 8, 'com.turquaz.cash.ui.CashUICashOtherCollectTransaction', 'Kasa Diger Tahsilat', 'admin', '2004-10-18', 'admin', '2004-10-18');
INSERT INTO turq_module_components VALUES (78, 8, 'com.turquaz.cash.ui.CashUICashOtherPaymentTransaction', 'Kasa Diger Odeme', 'admin', '2004-10-18', 'admin', '2004-10-18');
INSERT INTO turq_module_components VALUES (79, 8, 'com.turquaz.cash.ui.CashUICashTransferBetweenCards', 'Kasa Virman', 'admin', '2004-10-18', 'admin', '2004-10-18');

INSERT INTO turq_cash_transaction_types VALUES (2, 'Diger Tahsilat', 'admin', '2004-12-12', 'admin', '2004-12-12');
INSERT INTO turq_cash_transaction_types VALUES (3, 'Diger Odeme', 'admin', '2004-12-12', 'admin', '2004-12-12');
INSERT INTO turq_cash_transaction_types VALUES (4, 'Virman', 'admin', '2004-12-12', 'admin', '2004-12-12');

******************************************************************************


**********21-02-2005************************

----- Cash Card Transaction Tables Changed ---

ALTER TABLE turq_cash_transaction_rows ADD COLUMN cash_cards_id int4;
ALTER TABLE turq_cash_transaction_rows ADD CONSTRAINT row_to_card FOREIGN KEY (cash_cards_id) REFERENCES turq_cash_cards (cash_cards_id)    ON UPDATE RESTRICT ON DELETE RESTRICT;

update turq_cash_transaction_rows set cash_cards_id = turq_cash_transactions.cash_cards_id 
where cash_transactions_id = turq_cash_transactions.cash_transactions_id;

ALTER TABLE turq_cash_transaction_rows ALTER COLUMN cash_cards_id SET NOT NULL;
ALTER TABLE turq_cash_transactions DROP COLUMN cash_cards_id;
   
*******************************************************************   

************************22-02-2005******************************
------------New Default Values ----------------------
INSERT INTO turq_cash_transaction_types VALUES (5, 'Cek Tahsilat', 'admin', '2004-12-12', 'admin', '2004-12-12');
INSERT INTO turq_cheque_transaction_types VALUES (4, 'Cariden Tahsil', 4, 3, 'admin', '2005-01-01', 'admin', '2005-01-01');

INSERT INTO turq_module_components VALUES (80, 9, 'com.turquaz.cheque.ui.CheUIChequeCollect', 'Cariden Cek Tahsilati', 'admin', '2004-10-18', 'admin', '2004-10-18');


**********************************************************************


*********************24-02-2005***************************************
-------------- Current Accounting Tables -----------------------------

CREATE TABLE turq_current_accounting_types
(
  current_accouting_types_id int4 NOT NULL,
  type_name varchar(100) NOT NULL,
  definition varchar(100) NOT NULL,
  CONSTRAINT turq_current_accounting_types_pkey PRIMARY KEY (current_accouting_types_id)
) 
WITHOUT OIDS;

INSERT INTO turq_current_accounting_types VALUES (0, 'Cari Muhasebe Hesabi', ' ');
INSERT INTO turq_current_accounting_types VALUES (1, 'Alinan Cekler Muhasebe Hesabi', ' ');
INSERT INTO turq_current_accounting_types VALUES (2, 'Verilen Cekler Muhasebe Hesabi', ' ');


CREATE TABLE turq_current_accounting_accounts
(
  current_accounting_accounts_id int4 NOT NULL,
  current_cards_id int4 NOT NULL,
  accounting_accounts_id int4 NOT NULL,
  current_accounting_types_id int4 NOT NULL,
  created_by varchar(50) NOT NULL,
  creation_date date NOT NULL,
  updated_by varchar(50) NOT NULL,
  last_modified date NOT NULL,
  CONSTRAINT turq_current_accounting_accounts_pkey PRIMARY KEY (current_accounting_accounts_id),
  CONSTRAINT "curAcc1" FOREIGN KEY (accounting_accounts_id) REFERENCES turq_accounting_accounts (accounting_accounts_id) ON UPDATE RESTRICT ON DELETE RESTRICT,
  CONSTRAINT "curAcc2" FOREIGN KEY (current_accounting_types_id) REFERENCES turq_current_accounting_types (current_accouting_types_id) ON UPDATE RESTRICT ON DELETE RESTRICT,
  CONSTRAINT "curAcc3" FOREIGN KEY (current_cards_id) REFERENCES turq_current_cards (current_cards_id) ON UPDATE RESTRICT ON DELETE RESTRICT
) 
WITHOUT OIDS;

!!!!!!!!!!!!!!!!IMPORTANTT!!!!!!!!!!!!!!!!
In the preferences section of program,  export current card data to new Tables.. 
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!

----After you finished the above action continue with below---

ALTER TABLE turq_current_cards DROP COLUMN accounting_code_id;

---- Foreign Currency Support For current transactions --------

ALTER TABLE turq_current_transactions
   ADD COLUMN total_credit_in_foreign_currency numeric;
ALTER TABLE turq_current_transactions
   ADD COLUMN total_dept_in_foreign_currency numeric;
ALTER TABLE turq_current_transactions
   ADD COLUMN total_discount_in_foreign_currency numeric;

update turq_current_transactions set total_dept_in_foreign_currency = transactions_total_dept,
 total_credit_in_foreign_currency = transactions_total_credit, total_discount_in_foreign_currency = transactions_total_discount;

ALTER TABLE turq_current_transactions
   ALTER COLUMN total_credit_in_foreign_currency SET NOT NULL;
ALTER TABLE turq_current_transactions
   ALTER COLUMN total_dept_in_foreign_currency SET NOT NULL;
ALTER TABLE turq_current_transactions
   ALTER COLUMN total_discount_in_foreign_currency SET NOT NULL;
   
   
   
**********************view changes******************
***********************25-02-2005******************

--turq_view_acc_trans_total_amount updated--
****credit_amount -> rows_credit_in_base_currency***
****dept_amount -> rows_dept_in_base_currency***
drop view turq_view_acc_trans_total_amount;

CREATE OR REPLACE VIEW public.turq_view_acc_trans_total_amount AS 
 SELECT trans.accounting_transactions_id, tabletranscolumns.totalcreditamount, tabletranscolumns.totaldeptamount
   FROM turq_accounting_transactions trans
   LEFT JOIN ( SELECT transcolumns.accounting_transactions_id, sum(transcolumns.rows_credit_in_base_currency) AS totalcreditamount, sum(transcolumns.rows_dept_in_base_currency) AS totaldeptamount
                FROM turq_accounting_transaction_columns transcolumns
               GROUP BY transcolumns.accounting_transactions_id) tabletranscolumns ON tabletranscolumns.accounting_transactions_id = trans.accounting_transactions_id;
---new view created----
              
CREATE OR REPLACE VIEW public.turq_view_acc_totals AS 
 SELECT account.accounting_accounts_id, tabletranscolumns.totalcreditamount, tabletranscolumns.totaldeptamount
   FROM turq_accounting_accounts account
   LEFT JOIN ( SELECT transcolumns.accounting_accounts_id, sum(transcolumns.rows_credit_in_base_currency) AS totalcreditamount, sum(transcolumns.rows_dept_in_base_currency) AS totaldeptamount
                FROM turq_accounting_transaction_columns transcolumns
               GROUP BY transcolumns.accounting_accounts_id) tabletranscolumns ON tabletranscolumns.accounting_accounts_id = account.accounting_accounts_id
  ORDER BY account.accounting_accounts_id;


********************28-02-2005**************
**currencies unique index added*************
alter table turq_currencies add CONSTRAINT uniq_cur_abbr UNIQUE (currencies_abbreviation);
****************************************

********************* 01-03-2005 ****************
--------New Tables For Bank Accountings ------------
CREATE TABLE turq_bank_accounting_types
(
  bank_accouting_types_id int4 NOT NULL,
  type_name varchar(100) NOT NULL,
  definition varchar(100) NOT NULL,
  CONSTRAINT turq_bank_accounting_types_pkey PRIMARY KEY (bank_accouting_types_id)
) 

INSERT INTO turq_bank_accounting_types VALUES (0, 'Banka Muhasebe Hesabi', ' ');
INSERT INTO turq_bank_accounting_types VALUES (1, 'Tahsile Gelen Cekler Hesabi', ' ');
INSERT INTO turq_bank_accounting_types VALUES (2, 'Verilen Cekler Hesai', ' ');

CREATE TABLE turq_bank_accounting_accounts
(
  bank_accounting_accounts_id int4 NOT NULL,
  banks_cards_id int4 NOT NULL,
  accounting_accounts_id int4 NOT NULL,
  bank_accounting_types_id int4 NOT NULL,
  created_by varchar(50) NOT NULL,
  creation_date date NOT NULL,
  updated_by varchar(50) NOT NULL,
  last_modified date NOT NULL,
  CONSTRAINT turq_bank_accounting_accounts_pkey PRIMARY KEY (bank_accounting_accounts_id),
  CONSTRAINT "bankAcc1" FOREIGN KEY (accounting_accounts_id) REFERENCES turq_accounting_accounts (accounting_accounts_id) ON UPDATE RESTRICT ON DELETE RESTRICT,
  CONSTRAINT "bankAcc2" FOREIGN KEY (bank_accounting_types_id) REFERENCES turq_bank_accounting_types (bank_accouting_types_id) ON UPDATE RESTRICT ON DELETE RESTRICT,
  CONSTRAINT "bankAcc3" FOREIGN KEY (banks_cards_id) REFERENCES turq_banks_cards (banks_cards_id) ON UPDATE RESTRICT ON DELETE RESTRICT
) 

!!!!!!!!!!!!!!!!IMPORTANTT!!!!!!!!!!!!!!!!
In the preferences section of program,  export bank card data to new Tables.. 
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!

ALTER TABLE turq_banks_cards DROP COLUMN accounting_accounts_id;

*********************************************************************
*********************************************************************
ALTER TABLE turq_accounting_account_classes RENAME accounting_classes_id  TO id;
ALTER TABLE turq_accounting_account_types RENAME accounting_types_id  TO id;
ALTER TABLE turq_accounting_accounts RENAME accounting_accounts_id  TO id;
ALTER TABLE turq_accounting_journal RENAME accounting_journal_id  TO id;
ALTER TABLE turq_accounting_transaction_columns RENAME accounting_transaction_columns_id  TO id;
ALTER TABLE turq_accounting_transaction_types RENAME accounting_transaction_types_id  TO id;
ALTER TABLE turq_accounting_transactions RENAME accounting_transactions_id  TO id;
ALTER TABLE turq_bank_accounting_accounts RENAME bank_accounting_accounts_id  TO id;
ALTER TABLE turq_bank_accounting_types RENAME bank_accouting_types_id  TO id;
ALTER TABLE turq_bank_cards_secondary_accounts RENAME bank_cards_secondary_accounts_id  TO id;
ALTER TABLE turq_bank_secondary_accounts RENAME bank_secondary_accounts_id  TO id;
ALTER TABLE turq_banks_cards RENAME banks_cards_id  TO id;
ALTER TABLE turq_banks_transaction_bills RENAME banks_transaction_bills_id  TO id;
ALTER TABLE turq_banks_transaction_types RENAME bank_transaction_types_id  TO id;
ALTER TABLE turq_banks_transactions RENAME bank_transactions_id  TO id;
ALTER TABLE turq_bill_consignment_commons RENAME bill_consignment_common_id  TO id;
ALTER TABLE turq_bill_groups RENAME bill_groups_id  TO id;
ALTER TABLE turq_bill_in_groups RENAME bill_in_groups_id  TO id;
ALTER TABLE turq_bills RENAME bills_id  TO id;
ALTER TABLE turq_cash_cards RENAME cash_cards_id  TO id;
ALTER TABLE turq_cash_transaction_rows RENAME cash_transaction_rows_id  TO id;
ALTER TABLE turq_cash_transaction_types RENAME cash_transaction_types_id  TO id;
ALTER TABLE turq_cash_transactions RENAME cash_transactions_id  TO id;
ALTER TABLE turq_cheque_cheque_in_rolls RENAME cheque_cheques_rolls_id  TO id;
ALTER TABLE turq_cheque_cheques RENAME cheque_cheques_id  TO id;
ALTER TABLE turq_cheque_roll_accounting_accounts RENAME cheque_rolls_id  TO id;
ALTER TABLE turq_cheque_rolls RENAME cheque_rolls_id  TO id;
ALTER TABLE turq_cheque_transaction_types RENAME cheque_transaction_types_id  TO id;
ALTER TABLE turq_companies RENAME companies_id  TO id;
ALTER TABLE turq_consignment_groups RENAME consignment_groups_id  TO id;
ALTER TABLE turq_consignments RENAME consignments_id  TO id;
ALTER TABLE turq_consignments_in_group RENAME consignments_in_group_id  TO id;
ALTER TABLE turq_currencies RENAME currencies_id  TO id;
ALTER TABLE turq_currency_exchange_rates RENAME exchange_rates_id  TO id;
ALTER TABLE turq_current_accounting_accounts RENAME current_accounting_accounts_id  TO id;
ALTER TABLE turq_current_accounting_types RENAME current_accouting_types_id  TO id;
ALTER TABLE turq_users RENAME users_id  TO id;
ALTER TABLE turq_user_permissions RENAME user_permissions_id  TO id;
ALTER TABLE turq_user_group RENAME user_group_id  TO id;
ALTER TABLE turq_tradebill_transaction_types RENAME tradebill_transaction_types_id  TO id;
ALTER TABLE turq_tradebill_tradebills_rolls RENAME tradebill_tradebills_rolls_id  TO id;
ALTER TABLE turq_tradebill_tradebills RENAME tradebill_tradebills_id  TO id;
ALTER TABLE turq_tradebill_rolls RENAME tradebill_rolls_id  TO id;
ALTER TABLE turq_orders RENAME orders_id  TO id;
ALTER TABLE turq_order_in_groups RENAME order_in_groups_id  TO id;
ALTER TABLE turq_order_groups RENAME order_groups_id  TO id;
ALTER TABLE turq_modules RENAME modules_id  TO id;
ALTER TABLE turq_module_components RENAME module_components_id  TO id;
ALTER TABLE turq_inventory_warehouses RENAME inventory_warehouses_id  TO id;
ALTER TABLE turq_inventory_units RENAME inventory_units_id  TO id;
ALTER TABLE turq_inventory_transactions RENAME inventory_transactions_id  TO id;
ALTER TABLE turq_inventory_prices RENAME inventory_prices_id  TO id;
ALTER TABLE turq_inventory_groups RENAME inventory_groups_id  TO id;
ALTER TABLE turq_inventory_cards RENAME inventory_cards_id  TO id;
ALTER TABLE turq_inventory_card_units RENAME inventory_card_units_id  TO id;
ALTER TABLE turq_inventory_card_groups RENAME inventory_card_groups_id  TO id;
ALTER TABLE turq_groups RENAME groups_id  TO id;
ALTER TABLE turq_group_permissions RENAME group_permissions_id  TO id;
ALTER TABLE turq_engine_sequences RENAME engine_sequences_id  TO id;
ALTER TABLE turq_current_transactions RENAME current_transactions_id  TO id;
ALTER TABLE turq_current_transaction_types RENAME current_transaction_types_id  TO id;
ALTER TABLE turq_current_transaction_bill RENAME current_transaction_bill_id  TO id;
ALTER TABLE turq_current_groups RENAME current_groups_id  TO id;
ALTER TABLE turq_current_contacts RENAME current_contacts_id  TO id;
ALTER TABLE turq_current_cards_phones RENAME current_cards_phones_id  TO id;
ALTER TABLE turq_current_cards_groups RENAME current_cards_groups_id  TO id;
ALTER TABLE turq_current_cards RENAME current_cards_id  TO id;


***************02-03-2005***********************
-added column exchange_rate_id to acc_transactions and trans_columns***

ALTER TABLE turq_accounting_transaction_columns ADD COLUMN exchange_rate_id int4;
ALTER TABLE turq_accounting_transaction_columns DROP COLUMN rows_currency_type;
update turq_accounting_transaction_columns set exchange_rate_id=-1;
ALTER TABLE turq_accounting_transaction_columns
   ALTER COLUMN exchange_rate_id SET NOT NULL;

ALTER TABLE turq_accounting_transactions ADD COLUMN exchange_rate_id int4;
ALTER TABLE turq_accounting_transactions DROP COLUMN currencies_id;
update turq_accounting_transactions set exchange_rate_id=-1;
ALTER TABLE turq_accounting_transactions
   ALTER COLUMN exchange_rate_id SET NOT NULL;


INSERT INTO turq_currency_exchange_rates VALUES (-1,'2005-01-01',1,1,1);
ALTER TABLE public.turq_accounting_transaction_columns ADD CONSTRAINT ex_rate FOREIGN KEY (exchange_rate_id) REFERENCES turq_currency_exchange_rates (id)    ON UPDATE RESTRICT ON DELETE RESTRICT;
ALTER TABLE public.turq_accounting_transactions ADD CONSTRAINT ex_rate2 FOREIGN KEY (exchange_rate_id) REFERENCES turq_currency_exchange_rates (id)    ON UPDATE RESTRICT ON DELETE RESTRICT;

INSERT INTO turq_module_components VALUES (81, 5, 'com.turquaz.admin.ui.AdmUICurrencyAdd', 'Para Birimi Ekle', 'cem', '2005-02-28', 'cem', '2005-02-28');
INSERT INTO turq_module_components VALUES (82, 5, 'com.turquaz.admin.ui.AdmUICurrencyExchangeRateAdd', 'Para Degisim Orani Ekle', 'cem', '2005-02-28', 'cem', '2005-02-28');
INSERT INTO turq_module_components VALUES (83, 5, 'com.turquaz.admin.ui.AdmUICurrencyExchangeRateSearch', 'Para Degisim Orani Arama', 'cem', '2005-02-28', 'cem', '2005-02-28');



****exchange_rate_id column added to current transactions********

ALTER TABLE public.turq_currencies DROP COLUMN exchange_rate;

ALTER TABLE public.turq_current_transactions ADD COLUMN exchange_rate_id int4;
ALTER TABLE public.turq_current_transactions DROP COLUMN currencies_id;

update turq_current_transactions set exchange_rate_id=-1;

ALTER TABLE public.turq_current_transactions
   ALTER COLUMN exchange_rate_id SET NOT NULL;

ALTER TABLE public.turq_current_transactions ADD CONSTRAINT ex_rate3 FOREIGN KEY (exchange_rate_id) REFERENCES turq_currency_exchange_rates (id)    ON UPDATE RESTRICT ON DELETE RESTRICT;


***********************************************************
 *** 03/03/2005 hsqldb database updated v1.49 ***




************************foreign currency support***********************
************************06-03-2005**************************************

ALTER TABLE turq_cheque_cheques ADD COLUMN cheques_amount_in_foreign_currency numeric;
ALTER TABLE turq_cheque_cheques ADD COLUMN exchange_rate_id int4;

update turq_cheque_cheques set cheques_amount_in_foreign_currency=cheques_amount;
update turq_cheque_cheques set exchange_rate_id=-1;

ALTER TABLE turq_cheque_cheques
   ALTER COLUMN cheques_amount_in_foreign_currency SET NOT NULL;
ALTER TABLE turq_cheque_cheques
   ALTER COLUMN exchange_rate_id SET NOT NULL;

ALTER TABLE turq_cheque_cheques ADD CONSTRAINT ex_rate4 FOREIGN KEY (exchange_rate_id) 
REFERENCES turq_currency_exchange_rates (id)    ON UPDATE RESTRICT ON DELETE RESTRICT;






ALTER TABLE turq_cash_transaction_rows ADD COLUMN dept_amount_in_foreign_currency numeric;
ALTER TABLE turq_cash_transaction_rows ADD COLUMN credit_amount_in_foreign_currency numeric;
ALTER TABLE turq_cash_transaction_rows ADD COLUMN exchange_rate_id int4;

update turq_cash_transaction_rows set dept_amount_in_foreign_currency=dept_amount;
update turq_cash_transaction_rows set credit_amount_in_foreign_currency=credit_amount;
update turq_cash_transaction_rows set exchange_rate_id=-1;

ALTER TABLE turq_cash_transaction_rows
   ALTER COLUMN dept_amount_in_foreign_currency SET NOT NULL;
ALTER TABLE turq_cash_transaction_rows
   ALTER COLUMN credit_amount_in_foreign_currency SET NOT NULL;
ALTER TABLE turq_cash_transaction_rows
   ALTER COLUMN exchange_rate_id SET NOT NULL;

ALTER TABLE turq_cash_transaction_rows ADD CONSTRAINT ex_rate5 FOREIGN KEY (exchange_rate_id) 
REFERENCES turq_currency_exchange_rates (id)    ON UPDATE RESTRICT ON DELETE RESTRICT;

ALTER TABLE turq_bill_consignment_commons ADD COLUMN discount_rate_perc numeric;
ALTER TABLE turq_bill_consignment_commons ADD COLUMN discount_amount_in_foreign_currency numeric;
ALTER TABLE turq_bill_consignment_commons ADD COLUMN vat_amount_in_foreign_currency numeric;
ALTER TABLE turq_bill_consignment_commons ADD COLUMN charges_in_foreign_currency numeric;
ALTER TABLE turq_bill_consignment_commons ADD COLUMN total_amount_in_foreign_currency numeric;
ALTER TABLE turq_bill_consignment_commons ADD COLUMN special_vat_amount_in_foreign_currency numeric;
ALTER TABLE turq_bill_consignment_commons ADD COLUMN exchange_rate_id int4;


update turq_bill_consignment_commons set discount_rate_perc=discount_rate;
update turq_bill_consignment_commons set discount_amount_in_foreign_currency=discount_amount;
update turq_bill_consignment_commons set vat_amount_in_foreign_currency=vat_amount;
update turq_bill_consignment_commons set charges_in_foreign_currency=charges;
update turq_bill_consignment_commons set total_amount_in_foreign_currency=total_amount;
update turq_bill_consignment_commons set special_vat_amount_in_foreign_currency=special_vat_amount;
update turq_bill_consignment_commons set exchange_rate_id=-1;



ALTER TABLE turq_bill_consignment_commons
   ALTER COLUMN discount_rate_perc SET NOT NULL;
ALTER TABLE turq_bill_consignment_commons
   ALTER COLUMN discount_amount_in_foreign_currency SET NOT NULL;
ALTER TABLE turq_bill_consignment_commons
   ALTER COLUMN vat_amount_in_foreign_currency SET NOT NULL;
ALTER TABLE turq_bill_consignment_commons
   ALTER COLUMN charges_in_foreign_currency SET NOT NULL;
ALTER TABLE turq_bill_consignment_commons
   ALTER COLUMN total_amount_in_foreign_currency SET NOT NULL;
ALTER TABLE turq_bill_consignment_commons
   ALTER COLUMN special_vat_amount_in_foreign_currency SET NOT NULL;
ALTER TABLE turq_bill_consignment_commons DROP COLUMN discount_rate;
ALTER TABLE turq_bill_consignment_commons
   ALTER COLUMN exchange_rate_id SET NOT NULL;


ALTER TABLE turq_bill_consignment_commons ADD CONSTRAINT ex_rate6 FOREIGN KEY (exchange_rate_id) 
REFERENCES turq_currency_exchange_rates (id)    ON UPDATE RESTRICT ON DELETE RESTRICT;






ALTER TABLE turq_banks_transactions ADD COLUMN dept_amount_in_foreign_currency numeric;
ALTER TABLE turq_banks_transactions ADD COLUMN credit_amount_in_foreign_currency numeric;
ALTER TABLE turq_banks_transactions ADD COLUMN exchange_rate_id int4;


update turq_banks_transactions set dept_amount_in_foreign_currency=dept_amount;
update turq_banks_transactions set credit_amount_in_foreign_currency=credit_amount;
update turq_banks_transactions set exchange_rate_id=-1;


ALTER TABLE turq_banks_transactions
   ALTER COLUMN dept_amount_in_foreign_currency SET NOT NULL;
ALTER TABLE turq_banks_transactions
   ALTER COLUMN credit_amount_in_foreign_currency SET NOT NULL;
ALTER TABLE turq_banks_transactions
   ALTER COLUMN exchange_rate_id SET NOT NULL;


ALTER TABLE turq_banks_transactions ADD CONSTRAINT ex_rate7 FOREIGN KEY (exchange_rate_id) 
REFERENCES turq_currency_exchange_rates (id)    ON UPDATE RESTRICT ON DELETE RESTRICT;


**************************************************************************************
yukardakilerden sonra bunlar da cal?st?r?lacak..


ALTER TABLE turq_bill_consignment_commons RENAME discount_rate_perc  TO discount_rate;

**************************************************************************************

INSERT INTO turq_bank_accounting_types VALUES (3, 'Karsiliksiz Cek Hesabi', ' ');
INSERT INTO turq_cheque_transaction_types VALUES (5, 'Bankadan Iade', 5, 3, 'admin', '2005-01-01', 'admin', '2005-01-01');
INSERT INTO turq_module_components VALUES (84, 9, 'com.turquaz.cheque.ui.CheUIReturnFromBankRoll', 'Bankadan Iade Bordrosu', 'cem', '2005-02-28', 'cem', '2005-02-28');

INSERT INTO turq_cheque_transaction_types VALUES (6, 'Cariye Iade', 6, 3, 'admin', '2005-01-01', 'admin', '2005-01-01');

INSERT INTO turq_module_components VALUES (85, 9, 'com.turquaz.cheque.ui.CheUIReturnFromCurrent', 'Cariden Iade Bordrosu', 'cem', '2005-02-28', 'cem', '2005-02-28');


CREATE TABLE turq_inventory_accounting_accounts
(
  id int4 NOT NULL,
  inventory_cards_id int4 NOT NULL,
  accounting_accounts_id int4 NOT NULL,
  inventory_accounting_types_id int4 NOT NULL,
  created_by varchar(50) NOT NULL,
  creation_date date NOT NULL,
  updated_by varchar(50) NOT NULL,
  last_modified date NOT NULL
) 


CREATE TABLE turq_inventory_accounting_types
(
  id int4 NOT NULL,
  type_name varchar(100) NOT NULL,
  definition varchar(100) NOT NULL
) 

INSERT INTO turq_inventory_accounting_types VALUES (0, 'Buy', 'Alis Muhasebe Hesabi');
INSERT INTO turq_inventory_accounting_types VALUES (1, 'Sell', 'Satis Muhasebe Hesabi');
INSERT INTO turq_inventory_accounting_types VALUES (2, 'Buy VAT', 'Alis KDV Hesabi');
INSERT INTO turq_inventory_accounting_types VALUES (3, 'Sell VAT', 'Satis KDV Hesabi');
INSERT INTO turq_inventory_accounting_types VALUES (4, 'Buy Special VAT', 'Alis OTV Hesabi');
INSERT INTO turq_inventory_accounting_types VALUES (5, 'Sell Special VAT', 'Satis OTV Hesabi');
INSERT INTO turq_inventory_accounting_types VALUES (6, 'Buy Discount', 'Alistan Inidirimler Hesabi');
INSERT INTO turq_inventory_accounting_types VALUES (7, 'Sell Discount', 'Satistan Indirimler Hesabi');



ALTER TABLE turq_inventory_accounting_accounts 
ADD CONSTRAINT prim_id PRIMARY KEY (id);
ALTER TABLE turq_inventory_accounting_accounts 
ADD CONSTRAINT uniq UNIQUE (inventory_cards_id, accounting_accounts_id, inventory_accounting_types_id);

ALTER TABLE turq_inventory_accounting_types 
ADD CONSTRAINT p_id PRIMARY KEY (id);


ALTER TABLE turq_inventory_accounting_accounts ADD CONSTRAINT f_inv_card FOREIGN KEY (inventory_cards_id) 
REFERENCES turq_inventory_cards (id)    ON UPDATE RESTRICT ON DELETE RESTRICT;
ALTER TABLE turq_inventory_accounting_accounts ADD CONSTRAINT f_acc FOREIGN KEY (accounting_accounts_id) 
REFERENCES turq_accounting_accounts (id)    ON UPDATE RESTRICT ON DELETE RESTRICT;
ALTER TABLE turq_inventory_accounting_accounts ADD CONSTRAINT f_type FOREIGN KEY (inventory_accounting_types_id) 
REFERENCES turq_inventory_accounting_types (id)    ON UPDATE RESTRICT ON DELETE RESTRICT;

/****************************************************************************************/

!!!!!!IMPORTANT!!!!! Export Inventory Accounting Accounts HERE.....

****************************11-03-2005***************************************

ALTER TABLE turq_inventory_cards DROP COLUMN accounting_accounts_id_buy;
ALTER TABLE turq_inventory_cards DROP COLUMN accounting_accounts_id_sell;
ALTER TABLE turq_inventory_cards DROP COLUMN accounting_accounts_id_vat;
ALTER TABLE turq_inventory_cards DROP COLUMN accounting_accounts_id_special_vat;
ALTER TABLE turq_inventory_cards DROP COLUMN accounting_accounts_id_vat_sell;
ALTER TABLE turq_inventory_cards DROP COLUMN accounting_accounts_id_special_vat_sell;




CREATE TABLE turq_cheque_transaction_type_groups
(
   id int4, 
   group_name varchar(100), 
   definition varchar(250), 
   PRIMARY KEY (id)
);

insert into turq_cheque_transaction_type_groups values(1,'Portfoyde','');
insert into turq_cheque_transaction_type_groups values(2,'Ciro Edildi','');
insert into turq_cheque_transaction_type_groups values(3,'Tahsil Edildi','');
insert into turq_cheque_transaction_type_groups values(4,'Cariye Iade Edildi','');
insert into turq_cheque_transaction_type_groups values(5,'Karsiliksiz','');
insert into turq_cheque_transaction_type_groups values(6,'Tahsilde','');


DROP VIEW turq_view_cheque_status;
CREATE VIEW turq_view_cheque_status AS 
 SELECT cheq.id AS cheque_cheques_id, cheq.cheques_portfolio_no, cheq.cheques_no, cheq.banks_id, cheq.cheques_due_date, cheq.cheques_debtor, cheq.cheques_payment_place, cheq.cheques_value_date, cheq.cheques_amount, cheq.currencies_id, transtype.id AS cheque_transaction_types_id, transtype.transaction_typs_name,transtype.transaction_types_parent, rolls.id AS cheque_rolls_id, rolls.cheque_rolls_date, rolls.engine_sequences_id, rolls.cheque_roll_no, rolls.current_cards_id, rolls.banks_cards_id
   FROM turq_cheque_cheques cheq, turq_cheque_rolls rolls, turq_cheque_cheque_in_rolls cheqrolls, turq_cheque_transaction_types transtype
  WHERE cheq.id = cheqrolls.cheque_cheques_id AND rolls.id = cheqrolls.cheque_rolls_id AND transtype.id = rolls.cheque_transaction_types_id AND rolls.id = (( SELECT max(roll_inner.id)
           FROM turq_cheque_rolls roll_inner, turq_cheque_cheque_in_rolls cheqroll_inner, turq_cheque_cheques cheq_inner
          WHERE cheqroll_inner.cheque_rolls_id = roll_inner.id AND cheqroll_inner.cheque_cheques_id = cheq_inner.id AND cheqroll_inner.cheque_cheques_id = cheq.id));


ALTER TABLE turq_cheque_transaction_types DROP CONSTRAINT "$53";
ALTER TABLE turq_cheque_transaction_types DROP COLUMN accounting_accounts_id;

update turq_cheque_transaction_types set transaction_types_parent =1;
ALTER TABLE turq_cheque_transaction_types ADD CONSTRAINT type2groups FOREIGN KEY (transaction_types_parent) REFERENCES turq_cheque_transaction_type_groups (id)    ON UPDATE RESTRICT ON DELETE RESTRICT;

update turq_cheque_transaction_types set transaction_types_parent=1 where id = 0; 
update turq_cheque_transaction_types set transaction_types_parent=2 where id = 1;
update turq_cheque_transaction_types set transaction_types_parent=6 where id = 2;
update turq_cheque_transaction_types set transaction_types_parent=3 where id = 3;
update turq_cheque_transaction_types set transaction_types_parent=3 where id = 4;
update turq_cheque_transaction_types set transaction_types_parent=1 where id = 5;
update turq_cheque_transaction_types set transaction_types_parent=4 where id = 6;
update turq_cheque_transaction_types set transaction_typs_name="Portfoyden Cariye Iade" where id = 6;

INSERT INTO turq_cheque_transaction_types VALUES (7, 'Cariden Portfoye Iade', 1, 'admin', '2005-01-01', 'admin', '2005-01-01');
INSERT INTO turq_module_components VALUES (86, 9, 'com.turquaz.cheque.ui.CheUIReturnFromGivenCheques', 'Verilen Cek Iade Bordrosu', 'cem', '2005-02-28', 'cem', '2005-02-28');


**************************************************************************************;
!!!! makro datalari en son buraya kada update edildi...!!!
**************************************************************************************

CREATE TABLE turq_inventory_transaction_types
(
  id int4 NOT NULL,
  type_name varchar(100) NOT NULL,
  created_by varchar(100) NOT NULL,
  creation_date date NOT NULL,
  updated_by varchar(100) NOT NULL,
  last_modified date NOT NULL,
  CONSTRAINT id PRIMARY KEY (id)
) 

INSERT INTO turq_inventory_transaction_types VALUES (0, 'Acilis', 'admin', '2005-03-18', 'admin', '2005-03-18');
INSERT INTO turq_inventory_transaction_types VALUES (1, 'Alis/Satis', 'admin', '2005-03-18', 'admin', '2005-03-18');
INSERT INTO turq_inventory_transaction_types VALUES (2, 'Giris/Cikis', 'admin', '2005-03-18', 'admin', '2005-03-18');
INSERT INTO turq_inventory_transaction_types VALUES (3, 'Uretim', 'admin', '2005-03-18', 'admin', '2005-03-18');

ALTER TABLE turq_inventory_transactions ADD CONSTRAINT inv_type FOREIGN KEY (transaction_type) REFERENCES turq_inventory_transaction_types (id)    ON UPDATE RESTRICT ON DELETE RESTRICT;

ALTER TABLE turq_inventory_transactions
   ADD COLUMN document_no varchar(100);
ALTER TABLE turq_inventory_transactions
   ADD COLUMN definition varchar(250);
   
update turq_inventory_transactions set document_no ='';
update turq_inventory_transactions set definition ='';

ALTER TABLE turq_inventory_transactions
   ALTER COLUMN definition SET NOT NULL;
ALTER TABLE turq_inventory_transactions
   ALTER COLUMN document_no SET NOT NULL;
   
INSERT INTO turq_module_components VALUES (87, 0, 'com.turquaz.inventory.ui.InvUIOtherTransactionIn', 'Diger Giris Hareketi', 'cem', '2005-02-28', 'cem', '2005-02-28');

INSERT INTO turq_module_components VALUES (88, 0, 'com.turquaz.inventory.ui.InvUIOtherTransactionOut', 'Diger Cikis Hareketi', 'cem', '2005-02-28', 'cem', '2005-02-28');


**********************************************************************************
***********************************29-03-2005***************************************
CREATE TABLE turq_bill_in_engine_sequences
(
  id int4 NOT NULL,
  engine_sequences_id int4 NOT NULL,
  bills_id int4 NOT NULL,
  
  CONSTRAINT p_iddd PRIMARY KEY (id),
  CONSTRAINT f_bill_id FOREIGN KEY (bills_id) REFERENCES turq_bills (id) ON UPDATE RESTRICT ON DELETE RESTRICT,
  CONSTRAINT f_en_id FOREIGN KEY (engine_sequences_id) REFERENCES turq_engine_sequences (id) ON UPDATE RESTRICT ON DELETE RESTRICT
) 
************************************************************************************************
************************************************************************************************
***********************************!!!!!!!!IMPORTANT!!!!!!!!!!!!********************************
************************************************************************************************
******************************Yukardaki tabloyu olusturduktan sonra*****************************
******************************ozellikler kismindaki FillBillInEngineSeq*************************
****************************************calistirilmali******************************************
************************************************************************************************
************************************************************************************************
************************************************************************************************



ALTER TABLE turq_inventory_transactions RENAME transactions_unit_price  TO unit_price;
ALTER TABLE turq_inventory_transactions RENAME transactions_total_price  TO total_price;
ALTER TABLE turq_inventory_transactions RENAME transactions_discount  TO discount_rate;
ALTER TABLE turq_inventory_transactions RENAME transactions_discount_amount  TO discount_amount;
ALTER TABLE turq_inventory_transactions RENAME transactions_vat_amount  TO vat_amount;
ALTER TABLE turq_inventory_transactions RENAME transactions_vat_special_each  TO vat_special_unit_price;
ALTER TABLE turq_inventory_transactions RENAME transactions_vat_special  TO vat_special_rate;
ALTER TABLE turq_inventory_transactions RENAME transactions_vat_special_amount  TO vat_special_amount;
ALTER TABLE turq_inventory_transactions RENAME transactions_cumilative_price  TO cumilative_price;
ALTER TABLE turq_inventory_transactions RENAME transactions_total_amount_out  TO total_amount_out;
ALTER TABLE turq_inventory_transactions ADD COLUMN exchange_rate_id int4;
ALTER TABLE turq_inventory_transactions ADD COLUMN vat_rate numeric;

ALTER TABLE turq_consignments ADD COLUMN current_cards_id int4;
ALTER TABLE turq_consignments ADD COLUMN consignment_document_no varchar(50);

ALTER TABLE turq_bills ADD COLUMN bill_document_no varchar(50);
ALTER TABLE turq_bills ADD COLUMN current_cards_id int4;

update turq_inventory_transactions set exchange_rate_id=-1;
update turq_inventory_transactions set vat_rate=transactions_vat;

ALTER TABLE turq_inventory_transactions DROP COLUMN transactions_vat;

update turq_consignments set current_cards_id = turq_bill_consignment_commons.current_cards_id
where turq_bill_consignment_commons.id = bill_consignment_common_id;

update turq_consignments set consignment_document_no=turq_bill_consignment_commons.consignment_document_no
where bill_consignment_common_id=turq_bill_consignment_commons.id;

update turq_bills set bill_document_no=turq_bill_consignment_commons.bill_document_no
where bill_consignment_commons_id=turq_bill_consignment_commons.id;

update turq_bills set current_cards_id=turq_bill_consignment_commons.current_cards_id
where bill_consignment_commons_id=turq_bill_consignment_commons.id;

ALTER TABLE turq_bills
   ALTER COLUMN bill_document_no SET NOT NULL;
ALTER TABLE turq_bills
   ALTER COLUMN current_cards_id SET NOT NULL;

ALTER TABLE turq_consignments
   ALTER COLUMN current_cards_id SET NOT NULL;
ALTER TABLE turq_consignments
   ALTER COLUMN consignment_document_no SET NOT NULL;
ALTER TABLE turq_consignments ADD CONSTRAINT f_cur_card FOREIGN KEY (current_cards_id) 
REFERENCES turq_current_cards (id)    ON UPDATE RESTRICT ON DELETE RESTRICT;

ALTER TABLE turq_inventory_transactions
   ALTER COLUMN exchange_rate_id SET NOT NULL;
ALTER TABLE turq_inventory_transactions
   ALTER COLUMN vat_rate SET NOT NULL;
ALTER TABLE turq_inventory_transactions ADD CONSTRAINT f_ex_rate FOREIGN KEY (exchange_rate_id) 
REFERENCES turq_currency_exchange_rates (id)    ON UPDATE RESTRICT ON DELETE RESTRICT;

ALTER TABLE turq_bills ADD CONSTRAINT f_cur_card FOREIGN KEY (current_cards_id) 
REFERENCES turq_current_cards (id)    ON UPDATE RESTRICT ON DELETE RESTRICT;
ALTER TABLE turq_bills DROP COLUMN bill_consignment_commons_id;
ALTER TABLE turq_consignments DROP COLUMN bill_consignment_common_id;

drop table turq_bill_consignment_commons;

ALTER TABLE turq_inventory_transactions RENAME transactions_amount_in  TO amount_in;
ALTER TABLE turq_inventory_transactions RENAME total_amount_out  TO amount_out;

ALTER TABLE turq_inventory_transactions ADD COLUMN unit_price_in_foreign_currency numeric;
ALTER TABLE turq_inventory_transactions ADD COLUMN total_price_in_foreign_currency numeric;
ALTER TABLE turq_inventory_transactions ADD COLUMN discount_amount_in_foreign_currency numeric;
ALTER TABLE turq_inventory_transactions ADD COLUMN vat_amount_in_foreign_currency numeric;
ALTER TABLE turq_inventory_transactions ADD COLUMN vat_special_unit_price_in_foreign_currency numeric;
ALTER TABLE turq_inventory_transactions ADD COLUMN vat_special_amount_in_foreign_currency numeric;
ALTER TABLE turq_inventory_transactions ADD COLUMN cumilative_price_in_foreign_currency numeric;

update turq_inventory_transactions set unit_price_in_foreign_currency=unit_price;
update turq_inventory_transactions set total_price_in_foreign_currency=total_price;
update turq_inventory_transactions set cumilative_price_in_foreign_currency=cumilative_price;
update turq_inventory_transactions set discount_amount_in_foreign_currency=discount_amount;
update turq_inventory_transactions set vat_amount_in_foreign_currency=vat_amount;
update turq_inventory_transactions set vat_special_unit_price_in_foreign_currency=vat_special_unit_price;
update turq_inventory_transactions set vat_special_amount_in_foreign_currency=vat_special_amount;

ALTER TABLE turq_bills ADD COLUMN exchange_rate_id int4;
ALTER TABLE turq_consignments ADD COLUMN exchange_rate_id int4;

update turq_bills set exchange_rate_id=-1;
update turq_consignments set exchange_rate_id=-1;

ALTER TABLE turq_bills
   ALTER COLUMN exchange_rate_id SET NOT NULL;
ALTER TABLE turq_bills ADD CONSTRAINT f_ex_rate FOREIGN KEY (exchange_rate_id) 
REFERENCES turq_currency_exchange_rates (id)    ON UPDATE RESTRICT ON DELETE RESTRICT;

ALTER TABLE turq_consignments
   ALTER COLUMN exchange_rate_id SET NOT NULL;
ALTER TABLE turq_consignments ADD CONSTRAINT f_ex_rate FOREIGN KEY (exchange_rate_id) 
REFERENCES turq_currency_exchange_rates (id)    ON UPDATE RESTRICT ON DELETE RESTRICT;

ALTER TABLE turq_inventory_transactions
   ALTER COLUMN unit_price_in_foreign_currency SET NOT NULL;
ALTER TABLE turq_inventory_transactions
   ALTER COLUMN total_price_in_foreign_currency SET NOT NULL;
ALTER TABLE turq_inventory_transactions
   ALTER COLUMN discount_amount_in_foreign_currency SET NOT NULL;
ALTER TABLE turq_inventory_transactions
   ALTER COLUMN vat_amount_in_foreign_currency SET NOT NULL;
ALTER TABLE turq_inventory_transactions
   ALTER COLUMN vat_special_unit_price_in_foreign_currency SET NOT NULL;
ALTER TABLE turq_inventory_transactions
   ALTER COLUMN vat_special_amount_in_foreign_currency SET NOT NULL;
ALTER TABLE turq_inventory_transactions
   ALTER COLUMN cumilative_price_in_foreign_currency SET NOT NULL;

ALTER TABLE turq_consignments ADD COLUMN bill_document_no varchar(50);
update turq_consignments set bill_document_no='';
update turq_consignments set bill_document_no=turq_bills.bill_document_no
where turq_consignments.engine_sequences_id=turq_bill_in_engine_sequences.engine_sequences_id
and turq_bill_in_engine_sequences.bills_id=turq_bills.id;


ALTER TABLE turq_bills DROP COLUMN consignments_id;


ALTER TABLE turq_consignments
   ALTER COLUMN bill_document_no SET NOT NULL;

CREATE OR REPLACE VIEW turq_view_bill_trans_total AS 
 SELECT billin.bills_id, sum(invtrans.total_price_in_foreign_currency) AS totalprice,
 sum(invtrans.vat_amount_in_foreign_currency) AS vatamount, 
sum(invtrans.vat_special_amount_in_foreign_currency) AS specialvatamount,
 sum(invtrans.discount_amount_in_foreign_currency) AS discountamount
   FROM turq_inventory_transactions invtrans, turq_bill_in_engine_sequences billin
  WHERE invtrans.engine_sequences_id = billin.engine_sequences_id
  GROUP BY billin.bills_id;
  
  
  
CREATE OR REPLACE VIEW turq_view_inv_price_totals AS 
 SELECT invtrans.engine_sequences_id, sum(invtrans.total_price_in_foreign_currency) AS totalprice, sum(invtrans.vat_amount_in_foreign_currency) AS vatamount, sum(invtrans.vat_special_amount_in_foreign_currency) AS specialvatamount, sum(invtrans.discount_amount_in_foreign_currency) AS discountamount
   FROM turq_inventory_transactions invtrans
  GROUP BY invtrans.engine_sequences_id;

  

ALTER TABLE turq_inventory_transactions ADD COLUMN current_cards_id int4;

update turq_inventory_transactions set current_cards_id=-1;

update turq_inventory_transactions set current_cards_id=turq_consignments.current_cards_id
where engine_sequences_id=turq_consignments.engine_sequences_id;

update turq_inventory_transactions set current_cards_id=turq_bills.current_cards_id
where engine_sequences_id=turq_bill_in_engine_sequences.engine_sequences_id
and turq_bill_in_engine_sequences.bills_id=turq_bills.id;

ALTER TABLE turq_inventory_transactions
   ALTER COLUMN current_cards_id SET NOT NULL;

ALTER TABLE turq_inventory_transactions 
ADD CONSTRAINT f_cur_id FOREIGN KEY (current_cards_id) REFERENCES turq_current_cards (id)
    ON UPDATE RESTRICT ON DELETE RESTRICT;
    
 CREATE TABLE turq_settings( database_version varchar(50) NOT NULL);
 insert into turq_settings values('0.7.0');
 
 ALTER TABLE turq_users ADD CONSTRAINT u_name UNIQUE (username);

CREATE TABLE turq_user_permission_levels(  id int4 NOT NULL,
  permission_level int4 NOT NULL,  permission_name varchar(50) NOT NULL,
  permission_description varchar(50) NOT NULL,  CONSTRAINT p_level_id PRIMARY KEY (id));

 insert into turq_user_permission_levels values(0,0,'No Access','Hicbiri');
 insert into turq_user_permission_levels values(1,1,'Read','Okuma');
 insert into turq_user_permission_levels values(2,2,'Read/Write','Okuma/Yazma');
 insert into turq_user_permission_levels values(3,3,'Read/Write/Delete','Okuma/Yazma/Silme');

ALTER TABLE turq_user_permissions ADD CONSTRAINT f_level FOREIGN KEY 
(user_permissions_level) REFERENCES turq_user_permission_levels (id)    ON UPDATE RESTRICT ON DELETE RESTRICT;

**********************************************************************************

****************************06-04-2005*******************************
DROP TABLE TURQ_SETTINGS;
CREATE TABLE TURQ_SETTINGS(ID INTEGER NOT NULL PRIMARY KEY,DATABASE_VERSION VARCHAR(50) NOT NULL);
insert into turq_settings values(0,'0.7.0');
***********************************************


!!!!!!!!!!!!!!!!!!!0.7.0 Beta 1 yayinlandi...

INSERT INTO TURQ_CURRENT_TRANSACTION_TYPES VALUES((8,'Virman','admin','2004-10-18','admin','2004-10-18');
INSERT INTO turq_module_components VALUES (92, 4, 'com.turquaz.current.ui.CurUICurrentTransfer', 'Cari Virman', 'cem', '2005-02-28', 'cem', '2005-02-28');

!!!!!!!!!!!!!!!!!!!0.7.0 Beta 2 yayinlandi...
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!11

INSERT INTO turq_cash_transaction_types VALUES (6, 'Acilis', 'admin', '2004-12-12', 'admin', '2004-12-12');
INSERT INTO turq_module_components VALUES (93, 8, 'com.turquaz.cash.ui.CashUIInitialTransactions', 'Kasa Acilis', 'cem', '2005-02-28', 'cem', '2005-02-28');


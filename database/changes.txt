*** 04-02-2005 ****
- "turq_banks_transaction_bills" --> "banks_cards_id" column 
- "turq_banks_transactions"      --> "banks_cards_id" (integer) added 
-  Foreign key "banks_cards_id" from to "turq_banks_transactions" to "turq_banks_card"
- "turq_inventory_transactions" ---> "transaction_type" (integer) added 

*** 06-02-2005 *** 
-  "turq_inventory_transactions" ---> "transactions_amount_in" (int8) column changed to 
												"transactions_amount_in" numeric
-  "turq_inventory_transactions" ---> "transactions_total_amount_out" (int8) column changed to 

-  "turq_inventory_card_units" ---> "card_units_factor" changed column prop. int4 to numeric
												"transactions_total_amount_out" numeric
												
---Process---
!!!! Before drop, do not forget to backup the data inside tha tables!!!!!!!!!!!!!!!!!

DROP VIEW turq_view_inventory_totals;
DROP VIEW turq_view_inventory_amount_total;
DROP TABLE turq_inventory_transactions;

CREATE TABLE turq_inventory_transactions
(
  inventory_transactions_id int4 NOT NULL,
  inventory_cards_id int4 NOT NULL,
  inventory_warehouses_id int4 NOT NULL,
  engine_sequences_id int4 NOT NULL,
  transactions_amount_in numeric NOT NULL,
  inventory_units_id int4 NOT NULL,
  transactions_unit_price numeric NOT NULL,
  transactions_total_price numeric NOT NULL,
  transactions_discount numeric NOT NULL,
  transactions_discount_amount numeric NOT NULL,
  transactions_vat int4 NOT NULL,
  transactions_vat_amount numeric NOT NULL,
  transactions_vat_special_each numeric NOT NULL,
  transactions_vat_special numeric NOT NULL,
  transactions_vat_special_amount numeric NOT NULL,
  transactions_cumilative_price numeric NOT NULL,
  transactions_total_amount_out numeric NOT NULL,
  created_by varchar(50) NOT NULL,
  creation_date date NOT NULL,
  updated_by varchar(50) NOT NULL,
  last_modified date NOT NULL,
  transactions_date date NOT NULL,
  transaction_type int4 NOT NULL,
  CONSTRAINT turq_inventory_transactions_pkey PRIMARY KEY (inventory_transactions_id),
  CONSTRAINT "$100" FOREIGN KEY (engine_sequences_id) REFERENCES turq_engine_sequences (engine_sequences_id) ON UPDATE RESTRICT ON DELETE RESTRICT,
  CONSTRAINT "$15" FOREIGN KEY (inventory_warehouses_id) REFERENCES turq_inventory_warehouses (inventory_warehouses_id) ON UPDATE RESTRICT ON DELETE RESTRICT,
  CONSTRAINT "$16" FOREIGN KEY (inventory_cards_id) REFERENCES turq_inventory_cards (inventory_cards_id) ON UPDATE RESTRICT ON DELETE RESTRICT,
  CONSTRAINT "$17" FOREIGN KEY (inventory_units_id) REFERENCES turq_inventory_units (inventory_units_id) ON UPDATE RESTRICT ON DELETE RESTRICT
) 
WITHOUT OIDS;


CREATE OR REPLACE VIEW turq_view_inventory_totals AS 
 SELECT trans.inventory_cards_id, transin.totalamountin AS total_amount_in, transin.totalpricein AS total_price_in, transout.totalamountout AS total_amount_out, transout.totalpriceout AS total_price_out
   FROM turq_inventory_cards trans
   LEFT JOIN ( SELECT turq_inventory_transactions.inventory_cards_id, sum(turq_inventory_transactions.transactions_total_price) AS totalpricein, sum(turq_inventory_transactions.transactions_amount_in) AS totalamountin
                FROM turq_inventory_transactions
               WHERE turq_inventory_transactions.transactions_amount_in <> 0
               GROUP BY turq_inventory_transactions.inventory_cards_id) transin ON trans.inventory_cards_id = transin.inventory_cards_id
   LEFT JOIN ( SELECT turq_inventory_transactions.inventory_cards_id, sum(turq_inventory_transactions.transactions_total_price) AS totalpriceout, sum(turq_inventory_transactions.transactions_total_amount_out) AS totalamountout
                FROM turq_inventory_transactions
               WHERE turq_inventory_transactions.transactions_total_amount_out <> 0
               GROUP BY turq_inventory_transactions.inventory_cards_id) transout ON trans.inventory_cards_id = transout.inventory_cards_id;




CREATE OR REPLACE VIEW turq_view_inventory_amount_total AS 
 SELECT cards.inventory_cards_id, tabletrans.transactions_amount_in, tabletrans.transactions_total_amount_out, tabletrans.transactions_total_amount_now
   FROM turq_inventory_cards cards
   LEFT JOIN ( SELECT trans.inventory_cards_id, sum(trans.transactions_amount_in) AS transactions_amount_in, sum(trans.transactions_total_amount_out) AS transactions_total_amount_out, sum(trans.transactions_amount_in - trans.transactions_total_amount_out) AS transactions_total_amount_now
                FROM turq_inventory_transactions trans
               GROUP BY trans.inventory_cards_id) tabletrans ON tabletrans.inventory_cards_id = cards.inventory_cards_id;



*** 06-02-2005 **** 

-- "turq_inventory_groups" ---> "parent_group" (integer) column added
-- Foreign key from "parent_group" to "inventory_groups_id" in "turq_inventory_groups"

----Process---

ALTER TABLE turq_inventory_groups ADD COLUMN parent_group int4;

INSERT INTO turq_inventory_groups VALUES (-1, 'Varsayilan', 'Varsayilan', 'admin', '2005-01-14', 'admin', '2005-01-14', -1);

update turq_inventory_groups set parent_group =-1

ALTER TABLE turq_inventory_groups
   ALTER COLUMN parent_group SET NOT NULL;
   
ALTER TABLE turq_inventory_groups ADD CONSTRAINT ig1 FOREIGN KEY (parent_group) REFERENCES turq_inventory_groups (inventory_groups_id)    ON UPDATE RESTRICT ON DELETE RESTRICT;
   
INSERT INTO turq_inventory_groups VALUES (-1, 'Varsayilan', 'Varsayilan', 'admin', '2005-01-14', 'admin', '2005-01-14', -1);



**** 09-02-2005 *****
--- "turq_banks_transactions"  ----> "accounting_accounts_id" removed... 

ALTER TABLE turq_banks_transactions DROP COLUMN accounting_accounts_id;

**** 14-02-2005 *****
--- "turq_cheque_cheques" -----> "bank_account_no" column added...

ALTER TABLE turq_cheque_cheques ADD COLUMN bank_account_no varchar(100);
update turq_cheque_cheques set bank_account_no='';
ALTER TABLE turq_cheque_cheques
   ALTER COLUMN bank_account_no SET NOT NULL;


**** 15-02-2005 ****
--- "turq_bank_transactions_type" ---> "Bankaya Gelen Cek" --> Tahsil Edilen Cek...


**** 16-02-2005 **** 
---- "turq_cheque_rolls" --> sum totals column added...

ALTER TABLE turq_cheque_rolls
   ADD COLUMN sum_cheque_amounts bool;
   
update turq_cheque_rolls set sum_cheque_amounts = false;
   
ALTER TABLE turq_cheque_rolls
   ALTER COLUMN sum_cheque_amounts SET NOT NULL;



************* 17 FEBRUARY 0.6 ALPHA5 NEW VERSION RELEASED **********



INSERT INTO turq_cheque_transaction_types VALUES (2, 'Bankaya Cikis', 2, 3, 'admin', '2005-01-01', 'admin', '2005-01-01');
INSERT INTO turq_cheque_transaction_types VALUES (3, 'Bankadan Tahsil', 3, 3, 'admin', '2005-01-01', 'admin', '2005-01-01');


******CHANGES ON ACCOUNTING TABLES********

CREATE TABLE turq_accounting_account_classes (
    accounting_classes_id integer NOT NULL,
    accounting_classes_name character varying(50) NOT NULL,
    accounting_classes_definition character varying(50) NOT NULL,
    created_by character varying(25) NOT NULL,
    creation_date date NOT NULL,
    updated_by character varying(25) NOT NULL,
    last_modified date NOT NULL
);

ALTER TABLE turq_accounting_account_classes ADD PRIMARY KEY (accounting_classes_id);


CREATE TABLE turq_accounting_account_types (
    accounting_types_id integer NOT NULL,
    accounting_types_name character varying(50) NOT NULL,
    accounting_types_definition character varying(250) NOT NULL,
    created_by character varying(25) NOT NULL,
    creation_date date NOT NULL,
    updated_by character varying(25) NOT NULL,
    last_modified date NOT NULL
);

ALTER TABLE turq_accounting_account_types ADD PRIMARY KEY (accounting_types_id);




insert into turq_accounting_account_classes values (1,'DONEN VARLIKLAR','','admin','02-17-2005','admin','02-17-2005');
insert into turq_accounting_account_classes values (2,'DURAN VARLIKLAR','','admin','02-17-2005','admin','02-17-2005');
insert into turq_accounting_account_classes values (3,'KISA VADELI YABANCI KAYNAKLAR','','admin','02-17-2005','admin','02-17-2005');
insert into turq_accounting_account_classes values (4,'UZUN VADELI YABANCI KAYNAKLAR','','admin','02-17-2005','admin','02-17-2005');
insert into turq_accounting_account_classes values (5,'OZKAYNAKLAR','','admin','02-17-2005','admin','02-17-2005');
insert into turq_accounting_account_classes values (6,'GELIR TABLOSU HESAPLARI','','admin','02-17-2005','admin','02-17-2005');
insert into turq_accounting_account_classes values (7,'MALIYET HESAPLARI','','admin','02-17-2005','admin','02-17-2005');
insert into turq_accounting_account_classes values (8,'YONETIM MUHASEBESI HESAPLARI','','admin','02-17-2005','admin','02-17-2005');
insert into turq_accounting_account_classes values (9,'NAZIM HESAPLAR','','admin','02-17-2005','admin','02-17-2005');






insert into turq_accounting_account_types values (1,'HAZIR DEGERLER','','admin','02-17-2005','admin','02-17-2005');
insert into turq_accounting_account_types values (2,'MENKUL KIYMETLER','','admin','02-17-2005','admin','02-17-2005');
insert into turq_accounting_account_types values (3,'TICARI ALACAKLAR','','admin','02-17-2005','admin','02-17-2005');
insert into turq_accounting_account_types values (4,'DIGER ALACAKLAR','','admin','02-17-2005','admin','02-17-2005');
insert into turq_accounting_account_types values (5,'STOKLAR','','admin','02-17-2005','admin','02-17-2005');
insert into turq_accounting_account_types values (6,'YILLARA YAYGIN INSAAT VE ONARIM MALIYETLERI','','admin','02-17-2005','admin','02-17-2005');
insert into turq_accounting_account_types values (7,'GELECEK AYLARA AIT GIDERLER VE GELIR TAAHHUKLARI','','admin','02-17-2005','admin','02-17-2005');
insert into turq_accounting_account_types values (8,'DIGER DONEN VARLIKLAR','','admin','02-17-2005','admin','02-17-2005');
insert into turq_accounting_account_types values (9,'MALI DURAN VARLIKLAR','','admin','02-17-2005','admin','02-17-2005');
insert into turq_accounting_account_types values (10,'MADDI DURAN VARLIKLAR','','admin','02-17-2005','admin','02-17-2005');
insert into turq_accounting_account_types values (11,'MADDI OLMAYAN DURAN VARLIKLAR','','admin','02-17-2005','admin','02-17-2005');
insert into turq_accounting_account_types values (12,'OZEL TUKENMEYE TABI VARLIKLAR','','admin','02-17-2005','admin','02-17-2005');
insert into turq_accounting_account_types values (13,'GELECEK YILLARA AIT GIDERLER VE GELIR TAAHHUKLARI','','admin','02-17-2005','admin','02-17-2005');
insert into turq_accounting_account_types values (14,'DIGER DURAN VARLIKLAR','','admin','02-17-2005','admin','02-17-2005');
insert into turq_accounting_account_types values (15,'MALI BORCLAR','','admin','02-17-2005','admin','02-17-2005');
insert into turq_accounting_account_types values (16,'TICARI BORCLAR','','admin','02-17-2005','admin','02-17-2005');
insert into turq_accounting_account_types values (17,'DIGER BORCLAR','','admin','02-17-2005','admin','02-17-2005');
insert into turq_accounting_account_types values (18,'ALINAN AVANSLAR','','admin','02-17-2005','admin','02-17-2005');
insert into turq_accounting_account_types values (19,'BORC VE DIGER KARSILIKLARI','','admin','02-17-2005','admin','02-17-2005');
insert into turq_accounting_account_types values (20,'GELECEK YILLARA AIT GELIRLER VE GIDER TAAHHUKLARI','','admin','02-17-2005','admin','02-17-2005');
insert into turq_accounting_account_types values (21,'DIGER UZUN VADELI YABANCI KAYNAKLAR','','admin','02-17-2005','admin','02-17-2005');
insert into turq_accounting_account_types values (22,'GELECEK AYLARA AIT GELIR VE GIDER TAAHHUKLARI','','admin','02-17-2005','admin','02-17-2005');
insert into turq_accounting_account_types values (23,'ODENMIS SERMAYE','','admin','02-17-2005','admin','02-17-2005');
insert into turq_accounting_account_types values (24,'SERMAYE YEDEKLERI','','admin','02-17-2005','admin','02-17-2005');
insert into turq_accounting_account_types values (25,'KAR YEDEKLERI','','admin','02-17-2005','admin','02-17-2005');
insert into turq_accounting_account_types values (26,'GECMIS YILLAR KARLARI','','admin','02-17-2005','admin','02-17-2005');
insert into turq_accounting_account_types values (27,'GECMIS YILLAR ZARARLARI','','admin','02-17-2005','admin','02-17-2005');
insert into turq_accounting_account_types values (28,'DONEM NET KARI(ZARARI)','','admin','02-17-2005','admin','02-17-2005');
insert into turq_accounting_account_types values (29,'BRUT SATISLAR','','admin','02-17-2005','admin','02-17-2005');
insert into turq_accounting_account_types values (30,'SATIS INDIRIMLERI (-)','','admin','02-17-2005','admin','02-17-2005');
insert into turq_accounting_account_types values (31,'SATISLARIN MALIYETLERI (-)','','admin','02-17-2005','admin','02-17-2005');
insert into turq_accounting_account_types values (32,'FAALIYET GIDERLERI (-)','','admin','02-17-2005','admin','02-17-2005');
insert into turq_accounting_account_types values (33,'DIGER FAALIYETLERDEN OLAGAN GELIR VE KARLAR','','admin','02-17-2005','admin','02-17-2005');
insert into turq_accounting_account_types values (34,'DIGER FAALIYETLERDEN OLAGAN GIDER VE ZARARLAR (-)','','admin','02-17-2005','admin','02-17-2005');
insert into turq_accounting_account_types values (35,'FINANSMAN GIDERLERI(-)','','admin','02-17-2005','admin','02-17-2005');
insert into turq_accounting_account_types values (36,'OLAGANDISI GELIR VE KARLAR','','admin','02-17-2005','admin','02-17-2005');
insert into turq_accounting_account_types values (37,'OLAGANDISI GIDER VE ZARARLAR(-)','','admin','02-17-2005','admin','02-17-2005');
insert into turq_accounting_account_types values (38,'MALIYET MUHASEBES BAGLANTI HESAPLARI','','admin','02-17-2005','admin','02-17-2005');
insert into turq_accounting_account_types values (39,'DIREKT ILKMADDE VE MALZEME GIDERLERI','','admin','02-17-2005','admin','02-17-2005');
insert into turq_accounting_account_types values (40,'DIREKT ISCILIK GIDERLERI','','admin','02-17-2005','admin','02-17-2005');
insert into turq_accounting_account_types values (41,'GENEL URETIM GIDERLERI','','admin','02-17-2005','admin','02-17-2005');
insert into turq_accounting_account_types values (42,'HIZMET URETIM MALIYETLERI','','admin','02-17-2005','admin','02-17-2005');
insert into turq_accounting_account_types values (43,'ARASTIRMA VE GELISTIRME GIDERLERI','','admin','02-17-2005','admin','02-17-2005');
insert into turq_accounting_account_types values (44,'PAZARLAMA SATIS VE DAGITIM GIDERLERI','','admin','02-17-2005','admin','02-17-2005');
insert into turq_accounting_account_types values (45,'GENEL YONETIM GIDERLERI','','admin','02-17-2005','admin','02-17-2005');
insert into turq_accounting_account_types values (46,'FINANSMAN GIDERLERI (-)','','admin','02-17-2005','admin','02-17-2005');
insert into turq_accounting_account_types values (47,'FINANSMAN GIDERLERI ','','admin','02-17-2005','admin','02-17-2005');

ALTER TABLE turq_accounting_transaction_columns ADD COLUMN rows_currency_type int4;

update turq_accounting_transaction_columns set rows_currency_type = 1;

ALTER TABLE turq_accounting_transaction_columns ALTER COLUMN rows_currency_type SET NOT NULL;




ALTER TABLE turq_accounting_transaction_columns ADD COLUMN rows_dept_in_base_currency numeric;
update turq_accounting_transaction_columns set rows_dept_in_base_currency = dept_amount;
ALTER TABLE turq_accounting_transaction_columns ALTER COLUMN rows_dept_in_base_currency SET NOT NULL;



ALTER TABLE turq_accounting_transaction_columns ADD COLUMN rows_credit_in_base_currency numeric;
update turq_accounting_transaction_columns set rows_credit_in_base_currency = credit_amount;
ALTER TABLE turq_accounting_transaction_columns ALTER COLUMN rows_credit_in_base_currency SET NOT NULL;



ALTER TABLE turq_accounting_accounts
   ADD COLUMN accounting_types_id int4;

ALTER TABLE turq_accounting_accounts
   ADD COLUMN accounting_class_id int4;


update turq_accounting_accounts set accounting_types_id = 1;
update turq_accounting_accounts set accounting_class_id = 1;





ALTER TABLE turq_accounting_transaction_columns ADD CONSTRAINT ac1 FOREIGN KEY (rows_currency_type) REFERENCES turq_currencies (currencies_id)    ON UPDATE RESTRICT ON DELETE RESTRICT;


ALTER TABLE turq_currencies
   ADD COLUMN default_currency bool;

update turq_currencies set default_currency = false;

ALTER TABLE turq_currencies
   ALTER COLUMN default_currency SET NOT NULL;

ALTER TABLE turq_accounting_accounts ADD CONSTRAINT at1 FOREIGN KEY (accounting_types_id) REFERENCES turq_accounting_account_types (accounting_types_id)    ON UPDATE RESTRICT ON DELETE RESTRICT;

ALTER TABLE turq_accounting_accounts ADD CONSTRAINT ac1 FOREIGN KEY (accounting_class_id) REFERENCES turq_accounting_account_classes (accounting_classes_id)    ON UPDATE RESTRICT ON DELETE RESTRICT;




*********currency_exhange_rate_added (18-02-2005)*********************
CREATE TABLE public.turq_currency_exchange_rates
(
   exchange_rates_id int4 NOT NULL, 
   exhange_rates_date date NOT NULL, 
   base_currency_id int4 NOT NULL, 
   exchange_currency_id int4 NOT NULL, 
   exchange_ratio numeric NOT NULL, 
    PRIMARY KEY (exchange_rates_id), 
   CONSTRAINT fc1 FOREIGN KEY (base_currency_id) REFERENCES turq_currencies (currencies_id)    ON UPDATE RESTRICT ON DELETE RESTRICT, 
   CONSTRAINT fc2 FOREIGN KEY (exchange_currency_id) REFERENCES turq_currencies (currencies_id)    ON UPDATE RESTRICT ON DELETE RESTRICT, 
   CONSTRAINT uniq_value UNIQUE (exhange_rates_date, base_currency_id, exchange_currency_id)
) WITHOUT OIDS;

*******************************************************


******* (18-02-2005)*************
----turq_accounting_transactions ---> "currencies_id" added..

ALTER TABLE turq_accounting_transactions ADD COLUMN currencies_id int4;
ALTER TABLE turq_accounting_transactions ADD CONSTRAINT "accTransCurrencies" FOREIGN KEY (currencies_id) REFERENCES turq_currencies (currencies_id)    ON UPDATE RESTRICT ON DELETE RESTRICT;

update turq_accounting_transactions set currencies_id =1;
ALTER TABLE turq_accounting_transactions
   ALTER COLUMN currencies_id SET NOT NULL;
*******************************************************   
   
   
************ (19-02-2005) *****************   
---turq_view_cheque_status_changed---- 


DROP VIEW turq_view_cheque_status;

CREATE VIEW turq_view_cheque_status AS 
 SELECT cheq.cheque_cheques_id, cheq.cheques_portfolio_no, cheq.cheques_no, cheq.banks_id, cheq.cheques_due_date, cheq.cheques_debtor, cheq.cheques_payment_place, cheq.cheques_value_date, cheq.cheques_amount, cheq.currencies_id, transtype.cheque_transaction_types_id, transtype.transaction_typs_name, transtype.accounting_accounts_id, rolls.cheque_rolls_id, rolls.cheque_rolls_date, rolls.engine_sequences_id, rolls.cheque_roll_no, rolls.current_cards_id, rolls.banks_cards_id
FROM turq_cheque_cheques cheq, turq_cheque_rolls rolls, turq_cheque_cheque_in_rolls cheqrolls, turq_cheque_transaction_types transtype

WHERE cheq.cheque_cheques_id = cheqrolls.cheque_cheques_id AND rolls.cheque_rolls_id = cheqrolls.cheque_rolls_id AND transtype.cheque_transaction_types_id = rolls.cheque_transaction_types_id 
AND rolls.cheque_rolls_id = (( SELECT max(roll_inner.cheque_rolls_id)
FROM turq_cheque_rolls roll_inner, turq_cheque_cheque_in_rolls cheqroll_inner, turq_cheque_cheques cheq_inner
WHERE cheqroll_inner.cheque_rolls_id = roll_inner.cheque_rolls_id AND cheqroll_inner.cheque_cheques_id = cheq_inner.cheque_cheques_id AND cheqroll_inner.cheque_cheques_id = cheq.cheque_cheques_id));

******************** ***************************************
  
********************* New Table Added *****************************   
--turq_cheuqe_roll_accounting_accounts-----

  CREATE TABLE turq_cheque_roll_accounting_accounts
(
  cheque_rolls_id integer NOT NULL,
  accounting_accounts_id integer NOT NULL,
  CONSTRAINT turq_cheque_roll_accounting_accounts_pkey PRIMARY KEY (cheque_rolls_id),
  CONSTRAINT crac1 FOREIGN KEY (accounting_accounts_id) REFERENCES turq_accounting_accounts (accounting_accounts_id) ON UPDATE RESTRICT ON DELETE RESTRICT,
  CONSTRAINT crac2 FOREIGN KEY (cheque_rolls_id) REFERENCES turq_cheque_rolls (cheque_rolls_id) ON UPDATE RESTRICT ON DELETE RESTRICT
) 

**********************************************************************


*******************New Default Values ***********************************
INSERT INTO turq_module_components VALUES (77, 8, 'com.turquaz.cash.ui.CashUICashOtherCollectTransaction', 'Kasa Diger Tahsilat', 'admin', '2004-10-18', 'admin', '2004-10-18');
INSERT INTO turq_module_components VALUES (78, 8, 'com.turquaz.cash.ui.CashUICashOtherPaymentTransaction', 'Kasa Diger Odeme', 'admin', '2004-10-18', 'admin', '2004-10-18');
INSERT INTO turq_module_components VALUES (79, 8, 'com.turquaz.cash.ui.CashUICashTransferBetweenCards', 'Kasa Virman', 'admin', '2004-10-18', 'admin', '2004-10-18');

INSERT INTO turq_cash_transaction_types VALUES (2, 'Diger Tahsilat', 'admin', '2004-12-12', 'admin', '2004-12-12');
INSERT INTO turq_cash_transaction_types VALUES (3, 'Diger Odeme', 'admin', '2004-12-12', 'admin', '2004-12-12');
INSERT INTO turq_cash_transaction_types VALUES (4, 'Virman', 'admin', '2004-12-12', 'admin', '2004-12-12');

******************************************************************************


**********21-02-2005************************

----- Cash Card Transaction Tables Changed ---

ALTER TABLE turq_cash_transaction_rows ADD COLUMN cash_cards_id int4;
ALTER TABLE turq_cash_transaction_rows ADD CONSTRAINT row_to_card FOREIGN KEY (cash_cards_id) REFERENCES turq_cash_cards (cash_cards_id)    ON UPDATE RESTRICT ON DELETE RESTRICT;

update turq_cash_transaction_rows set cash_cards_id = turq_cash_transactions.cash_cards_id 
where cash_transactions_id = turq_cash_transactions.cash_transactions_id;

ALTER TABLE turq_cash_transaction_rows ALTER COLUMN cash_cards_id SET NOT NULL;
ALTER TABLE turq_cash_transactions DROP COLUMN cash_cards_id;
   
*******************************************************************   

************************22-02-2005******************************
------------New Default Values ----------------------
INSERT INTO turq_cash_transaction_types VALUES (5, 'Cek Tahsilat', 'admin', '2004-12-12', 'admin', '2004-12-12');
INSERT INTO turq_cheque_transaction_types VALUES (4, 'Cariden Tahsil', 4, 3, 'admin', '2005-01-01', 'admin', '2005-01-01');

INSERT INTO turq_module_components VALUES (80, 9, 'com.turquaz.cheque.ui.CheUIChequeCollect', 'Cariden Cek Tahsilati', 'admin', '2004-10-18', 'admin', '2004-10-18');


**********************************************************************


*********************24-02-2005***************************************
-------------- Current Accounting Tables -----------------------------

CREATE TABLE turq_current_accounting_types
(
  current_accouting_types_id int4 NOT NULL,
  type_name varchar(100) NOT NULL,
  definition varchar(100) NOT NULL,
  CONSTRAINT turq_current_accounting_types_pkey PRIMARY KEY (current_accouting_types_id)
) 
WITHOUT OIDS;

INSERT INTO turq_current_accounting_types VALUES (0, 'Cari Muhasebe Hesabi', ' ');
INSERT INTO turq_current_accounting_types VALUES (1, 'Alinan Cekler Muhasebe Hesabi', ' ');
INSERT INTO turq_current_accounting_types VALUES (2, 'Verilen Cekler Muhasebe Hesabi', ' ');


CREATE TABLE turq_current_accounting_accounts
(
  current_accounting_accounts_id int4 NOT NULL,
  current_cards_id int4 NOT NULL,
  accounting_accounts_id int4 NOT NULL,
  current_accounting_types_id int4 NOT NULL,
  created_by varchar(50) NOT NULL,
  creation_date date NOT NULL,
  updated_by varchar(50) NOT NULL,
  last_modified date NOT NULL,
  CONSTRAINT turq_current_accounting_accounts_pkey PRIMARY KEY (current_accounting_accounts_id),
  CONSTRAINT "curAcc1" FOREIGN KEY (accounting_accounts_id) REFERENCES turq_accounting_accounts (accounting_accounts_id) ON UPDATE RESTRICT ON DELETE RESTRICT,
  CONSTRAINT "curAcc2" FOREIGN KEY (current_accounting_types_id) REFERENCES turq_current_accounting_types (current_accouting_types_id) ON UPDATE RESTRICT ON DELETE RESTRICT,
  CONSTRAINT "curAcc3" FOREIGN KEY (current_cards_id) REFERENCES turq_current_cards (current_cards_id) ON UPDATE RESTRICT ON DELETE RESTRICT
) 
WITHOUT OIDS;

!!!!!!!!!!!!!!!!IMPORTANTT!!!!!!!!!!!!!!!!
In the preferences section of program,  export current card data to new Tables.. 
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!

----After you finished the above action continue with below---

ALTER TABLE turq_current_cards DROP COLUMN accounting_code_id;

---- Foreign Currency Support For current transactions --------

ALTER TABLE turq_current_transactions
   ADD COLUMN total_credit_in_foreign_currency numeric;
ALTER TABLE turq_current_transactions
   ADD COLUMN total_dept_in_foreign_currency numeric;
ALTER TABLE turq_current_transactions
   ADD COLUMN total_discount_in_foreign_currency numeric;

update turq_current_transactions set total_dept_in_foreign_currency = transactions_total_dept,
 total_credit_in_foreign_currency = transactions_total_credit, total_discount_in_foreign_currency = transactions_total_discount;

ALTER TABLE turq_current_transactions
   ALTER COLUMN total_credit_in_foreign_currency SET NOT NULL;
ALTER TABLE turq_current_transactions
   ALTER COLUMN total_dept_in_foreign_currency SET NOT NULL;
ALTER TABLE turq_current_transactions
   ALTER COLUMN total_discount_in_foreign_currency SET NOT NULL;
   
   
   
**********************view changes******************
***********************25-02-2005******************

--turq_view_acc_trans_total_amount updated--
****credit_amount -> rows_credit_in_base_currency***
****dept_amount -> rows_dept_in_base_currency***
drop view turq_view_acc_trans_total_amount;

CREATE OR REPLACE VIEW public.turq_view_acc_trans_total_amount AS 
 SELECT trans.accounting_transactions_id, tabletranscolumns.totalcreditamount, tabletranscolumns.totaldeptamount
   FROM turq_accounting_transactions trans
   LEFT JOIN ( SELECT transcolumns.accounting_transactions_id, sum(transcolumns.rows_credit_in_base_currency) AS totalcreditamount, sum(transcolumns.rows_dept_in_base_currency) AS totaldeptamount
                FROM turq_accounting_transaction_columns transcolumns
               GROUP BY transcolumns.accounting_transactions_id) tabletranscolumns ON tabletranscolumns.accounting_transactions_id = trans.accounting_transactions_id;
---new view created----
              
CREATE OR REPLACE VIEW public.turq_view_acc_totals AS 
 SELECT account.accounting_accounts_id, tabletranscolumns.totalcreditamount, tabletranscolumns.totaldeptamount
   FROM turq_accounting_accounts account
   LEFT JOIN ( SELECT transcolumns.accounting_accounts_id, sum(transcolumns.rows_credit_in_base_currency) AS totalcreditamount, sum(transcolumns.rows_dept_in_base_currency) AS totaldeptamount
                FROM turq_accounting_transaction_columns transcolumns
               GROUP BY transcolumns.accounting_accounts_id) tabletranscolumns ON tabletranscolumns.accounting_accounts_id = account.accounting_accounts_id
  ORDER BY account.accounting_accounts_id;


********************28-02-2005**************
**currencies unique index added*************
alter table turq_currencies add CONSTRAINT uniq_cur_abbr UNIQUE (currencies_abbreviation);
****************************************
